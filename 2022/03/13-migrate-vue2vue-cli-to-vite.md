### Vue2 + vue property decorator + vue-cli에서 vite로 마이그레이션 해보기

#### 문제의 발단
- 현재 메인 프로젝트들이 Vue2 + vue property decorator + vue-cli로 되어 있는데 build & serve 속도가 너무 느리다. 
- alpha build는 10분 정도 걸려서 빌드 돌리고 화장실 갔다와도 아직 다 안 되어있다. 너무 짜증났다.

#### 처음 시도해본 것

- vue2를 당장 모던한 것으로 마이그할 수 없으니 코드는 그대로 두고 빌드만 빠르게 할 방법을 찾아봐야 한다.
- vue.config.js를 수정해 이리저리 시도해 봤다. esbuild, dll?.. 하다 보니 build chunk 최적화를 하게 되었다.
- 여기서 발견한 문제는 프로젝트 크기가 너무 크다는 것이다. analyzer로 보면 메인 app.js가 가지고있는 모듈이 2390개였고, lazy loading, chunk 적용해서 줄여봐도 1300개 정도였다.
- 빌드 속도는 이정도 프로젝트 크기면 빠른게 아닐까?..

#### 다시 시도해본 것

- vue.config.js는 포기하고 아예 빌드 툴을 새롭게 가져와 봤다.
- vite로 react를 했을 경우에는 쾌적했어서 진행해봤다. 사실 두번째 시도였다.
- 난관이 되게 많았는데 지금도 전부 해결된 상태는 아니다.

1. vite는 공식적으로 vue3부터 플러그인을 지원한다. vite-plugin-vue2라는 개인이 만든 것을 사용했다.
2. vue property decorator에서 decorator를 사용하지 않는 경우는 적지 않아도 된다. 
- 이것 때문에 많이 헤맸는데 `@Component({component: ~~ })` 로 적으면 컴파일러가 알아보는데 `@Component`로 빈것을 적으면 해석을 못해서 에러가 난다. 
- `@Component` 이런식으로 사용된것을 지워주면 해결된다.

3. require로 import하게 되면 에러가 난다. vite가 commonjs가 지원이 안되는건지 내가 설정을 못한건지는 모르겠다. 어쨌든 import 하나만 쓰는것이 좋으니 잘못 쓴것이 있다면 고쳐준다.
- 참고: 기본이 js로 되어 있는 라이브러리라면 @types를 받아야 import로 쓸 수 있었다. 
-  `require.context()` 문법으로 되어 있는 곳은 로직이 들어간 부분이라 import로 바꾸기가 어려웠는데 이건 플러그인이 있었다(휴..) `@originjs/vite-plugin-require-context` 이걸 쓰면 된다.

4. summernote jQuery is not defined 에러가 난다.
- 아래 내용이 서머노트 공식에서 webpack 설정으로 해놓으라고 한건데, 이거 관련해서 vite 플러그인을 못찾았다. 왜 jquery가 아니라 jQuery로 쓰는거지? 
- ProvidePlugin은 옵션으로 적은라이브러리를 미리 key값으로 세팅해놓는다는 것 같은데 소스를 봐도 webpack 내부에서 엮여있어서 무슨기능인지정확히 이해를 못했다.
```
    plugins: [
      new webpack.ProvidePlugin({
        $: 'jquery',
        jQuery: 'jquery',
      }),
    ],
```
- 이부분은 도저히 모르겠어서 서머노트 부분 주석처리하고 넘어갔다.

5. vuex unknown mutation type 에러가 난다.

- 이 시점부터 화면이 랜더링이 됐다!!! 로그인 페이지에서 눌렀을때 API 도 호출하는 것 보면 다른건 멀쩡한것 같았다.
- 근데 vuex가 동작이 아무것도 안해서 다른페이지는 못봤다..
- 관련 레퍼런스가 아무리 찾아도 없어서 vite-plugin-vue2 이슈로 등록해볼까 한다. 

6. vuex 해결하면 바꿀만 한가?

- 이게 문제다. 이번 삽질을 하면서 원론적인 문제를 알게 됐는데 프로젝트가 너무 크면 빌드 툴의 문제는 아닐지도 모른다는 것이다.
- vite는 serve 시에 터미널에는 빠르게 되는 것처럼 찍히지만(1초 내외) 결국 로딩하는 파일이 많아 브라우저에서 로딩이 오래 걸린다. 체감상으로는 vue-cli와 비슷했다. (내가 원하는건 최대 10초 정도였는데 그거보단 확실히 길었다)
- vite build 는 에러 때문에 제대로 실행은 못해 봤지만 vue-cli(5~6분)보다는 빠르지 않을까 싶긴 하다.
- 다음 단계로 생각하는 건 모노레포인데.. 모노레포로 분리를 하면 빌드를 나눠서 할 수 있을지 나눠서 하면 어떻게 반영이 되는지?? 생각을 해봐야할 것 같다. 
- 아니면 vue3로 vue에서 지원하는대로 코드수정 최소한으로 해서 마이그해야 하고 최적화하는 식으로 해야하지 않을까 ?? 
- 이거 때문에 미치겠다. 너무 스트레스가 크다.. 얼른 좋은쪽으로 결론짓고 싶다. 
